---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

### Download file and load to R

First we use the download.file() function to download the raw data file, then use read.table and unz
() to load it to R.

```{r echo=TRUE}

download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip", "activity data.zip")

data <- read.table(unz("activity data.zip", "activity.csv"), header=T, sep=",")


```

### Review the data

Now we take a look at the data set to ensure it is consistent with our expectations. We use the str(), summary() and head() functions to explore the data.

```{r echo=TRUE}

str(data)
summary(data)
head(data)

```

## What is mean total number of steps taken per day?

To determine the mean total number of steps per day, we first aggregate the daily totals using the aggregate() function and then use the daily totals to calculate the mean and the median of the daily step counts.  We can also plot the distribution of daily step count using a histogram.

```{r echo=TRUE}

daily_steps <- aggregate(data$steps, list(data$date), FUN=sum)
names(daily_steps) <- c("date", "total_steps")
hist(daily_steps$total_steps, main="Histogram of Daily Step Totals", xlab = "Daily Steps Totals")
mean(daily_steps$total_steps, na.rm = TRUE)
median(daily_steps$total_steps, na.rm = TRUE)

```


## What is the average daily activity pattern?

To determine the average daily step pattern, we now aggregate the data across all days, and by time-bin.  Then we can plot the averages and determine the most active time period (on average) of all of the days measured.  We can then use the max() function to determine which interval averages the highest number of steps. 


```{r echo=TRUE}

interval_avg <- aggregate(data$steps, list(data$interval), FUN=mean, na.rm=TRUE)
names(interval_avg) <- c("Interval", "TotalSteps")

plot(interval_avg, type="l", main="Average steps per interval", xlab="Interval", ylab="Average No. Steps")

interval_avg[which(interval_avg$TotalSteps == max(interval_avg$TotalSteps)),]

```

This shows that the 835 time interval on average has the most number of steps with a monthly average of `r max(interval_avg$TotalSteps)` steps.

## Imputing missing values

First we determine how many rows of the dataset contain NA values for the steps variable.  We can do this by calling the nrow() function on the subset of "data" which contains NA values in the steps column.

```{r echo=TRUE}

nrow(data[is.na(data$steps),])

```

This shows that there are `r nrow(data[is.na(data$steps),])` NA values in steps variable of the data table. Furhtermore, it is clear that all of these NA values occur on individual days (and there are 8 of these (8 x 288 = 2,304!))

A very simple imputation model would be to replace these values with the average number of steps per time interval into these days.  We can take the values from the interval_avg data table.  To do this, we create a new data frame called "new_data" and merge the NA values in the "data" frame into it and merge with the average steps from the "interval_avg" frame.  Then we can use rbind() to link the new average values with the existing non-NA values in the "data" frame.

Once we are done, we confirm with the summary() function that we have removed the NA values and also use nrow() to double check.

```{r echo=TRUE}

new_data <- data
new_data <- merge(data[is.na(data$steps),],interval_avg, by.x="interval", by.y="Interval", all.x=TRUE)
new_data <- new_data[,c(4,3,1)]
names(new_data) <- c("steps", "date", "interval")
new_data2 <- rbind(data[!is.na(data$steps),], new_data)

summary(new_data2)

nrow(new_data2[is.na(new_data2$steps),])

```


## Are there differences in activity patterns between weekdays and weekends?
